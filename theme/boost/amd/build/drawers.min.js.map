{"version":3,"sources":["../src/drawers.js"],"names":["backdropPromise","pageWrapper","document","getElementById","page","Sizes","medium","large","getBackdrop","Templates","render","then","html","ModalBackdrop","fail","Notification","exception","closeDrawer","pageDrawer","toggleButton","closeBackdrop","preference","getAttribute","state","Aria","hide","classList","remove","isMedium","M","util","set_user_preference","backdrop","style","overflow","catch","showDrawer","unhide","add","show","getRoot","addEventListener","trigger","dispatchEvent","CustomEvent","bubbles","detail","body","clientWidth","isLarge","activateDrawer","closeButton","querySelector","contains","focus","window","e","setAttribute","scroller","drawerLayout","scrollTop","innerHeight","init","drawers","querySelectorAll","forEach","hasAttribute"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Toggling the visibility of the secondary navigation on mobile.\n *\n * @package    theme_boost\n * @copyright  2021 Bas Brands\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport ModalBackdrop from 'core/modal_backdrop';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as Aria from 'core/aria';\n\nlet backdropPromise = null;\nconst pageWrapper = document.getElementById('page-wrapper');\nconst page = document.getElementById('page');\n\n/**\n * Maximum sizes for breakpoints. This needs to correspond with Bootstrap\n * Breakpoints\n */\nconst Sizes = {\n    medium: 991,\n    large: 1200\n};\n\n/**\n * Add a backdrop to the page.\n * @return {Promise} rendering of modal backdrop.\n */\nconst getBackdrop = () => {\n    if (!backdropPromise) {\n        backdropPromise = Templates.render('core/modal_backdrop', {})\n            .then(html => {\n                return new ModalBackdrop(html);\n            })\n            .fail(Notification.exception);\n    }\n    return backdropPromise;\n};\n\n/**\n * Close the drawer\n *\n * @param {DOMElement} pageDrawer The drawer to close.\n * @param {DOMElement} toggleButton The button toggling the drawer.\n * @param {Bool} closeBackdrop Remove the backdrop on closing.\n */\nconst closeDrawer = (pageDrawer, toggleButton, closeBackdrop = true) => {\n    const preference = toggleButton.getAttribute('data-preference');\n    const state = toggleButton.getAttribute('data-state');\n    Aria.hide(pageDrawer);\n    pageDrawer.classList.remove('show');\n\n    if (state) {\n        page.classList.remove(state);\n    }\n    if (!isMedium() && preference) {\n        M.util.set_user_preference(preference, false);\n    }\n\n    if (isMedium() && closeBackdrop) {\n        getBackdrop().then(backdrop => {\n            backdrop.hide();\n            pageWrapper.style.overflow = 'auto';\n            return null;\n        }).catch(Notification.exception);\n    }\n};\n\n/**\n * Show the drawer\n *\n * @param {DOMElement} pageDrawer The drawer to open.\n * @param {DOMElement} toggleButton The button toggling the drawer.\n */\nconst showDrawer = (pageDrawer, toggleButton) => {\n    const preference = toggleButton.getAttribute('data-preference');\n    const state = toggleButton.getAttribute('data-state');\n\n    Aria.unhide(pageDrawer);\n    pageDrawer.classList.add('show');\n\n    if (!isMedium() && preference) {\n        M.util.set_user_preference(preference, true);\n    }\n\n    if (state) {\n        page.classList.add(state);\n    }\n\n    if (isMedium()) {\n        getBackdrop().then(backdrop => {\n            backdrop.show();\n            pageWrapper.style.overflow = 'hidden';\n            backdrop.getRoot()[0].addEventListener('click', () => {\n                closeDrawer(pageDrawer);\n            });\n            return null;\n        }).catch(Notification.exception);\n    }\n\n    const trigger = pageDrawer.getAttribute('data-trigger');\n    if (trigger) {\n        pageDrawer.dispatchEvent(new CustomEvent('show-boost-drawer', {bubbles: true, detail: trigger}));\n    }\n};\n\n/**\n * Check if the user uses a medium size browser.\n * @returns {Bool} true if the body is smaller than Sizes.medium max size.\n */\nconst isMedium = () => {\n    return document.body.clientWidth <= Sizes.medium;\n};\n\n/**\n * Check if the user uses a medium size browser.\n * @returns {Bool} true if the body is smaller than Sizes.large max size.\n */\nconst isLarge = () => {\n    return document.body.clientWidth <= Sizes.large;\n};\n\n/**\n * Activate the event listeners for this drawer.\n *\n * @param {DOMElement} pageDrawer the drawer\n * @param {DOMElement} toggleButton the button that toggles the drawer\n*/\nconst activateDrawer = (pageDrawer, toggleButton) => {\n    const closeButton = pageDrawer.querySelector('[data-action=\"closedrawer\"]');\n\n    if (!pageDrawer.classList.contains('show')) {\n        Aria.hide(pageDrawer);\n    }\n\n    toggleButton.addEventListener('click', () => {\n        if (pageDrawer.classList.contains('show')) {\n            closeDrawer(pageDrawer, toggleButton);\n            toggleButton.focus();\n        } else {\n            showDrawer(pageDrawer, toggleButton);\n            closeButton.focus();\n        }\n    });\n\n    if (closeButton) {\n        closeButton.addEventListener('click', () => {\n            closeDrawer(pageDrawer, toggleButton);\n            toggleButton.focus();\n        });\n    }\n\n    if (toggleButton.getAttribute('data-closeonresize')) {\n        window.addEventListener('resize', () => {\n            if (isLarge() && !isMedium()) {\n                closeDrawer(pageDrawer, toggleButton);\n            }\n        });\n    }\n\n    // Close drawer when another drawer opens.\n    document.addEventListener('show-boost-drawer', e => {\n        const trigger = pageDrawer.getAttribute('data-trigger');\n        if (trigger != e.detail && isLarge()) {\n            closeDrawer(pageDrawer, toggleButton, false);\n        }\n    });\n    pageDrawer.setAttribute('initialised', 'true');\n};\n\n/** Activate the scroller helper for the drawer layout\n */\nconst scroller = () => {\n    const body = document.querySelector('body');\n    const drawerLayout = document.querySelector('#page.drawers');\n    drawerLayout.addEventListener(\"scroll\", () => {\n        if (drawerLayout.scrollTop >= window.innerHeight) {\n            body.classList.add('scrolled');\n        } else {\n            body.classList.remove('scrolled');\n        }\n    });\n};\n\n/**\n * Activate all drawers for this page\n *\n * @param {String} drawer unique identifier for the drawer to toggle\n * @param {String} toggle unique identifier for the drawer toggle button\n */\nexport const init = () => {\n    scroller();\n    const drawers = document.querySelectorAll('[data-region=\"fixed-drawer\"]');\n    drawers.forEach((pageDrawer) => {\n        if (!pageDrawer.hasAttribute('initialised')) {\n            const trigger = pageDrawer.getAttribute('data-trigger');\n            if (trigger) {\n                const toggleButton = document.querySelector(`[data-action=\"${trigger}\"]`);\n                if (toggleButton) {\n                    activateDrawer(pageDrawer, toggleButton);\n                }\n            }\n        }\n    });\n};\n"],"file":"drawers.min.js"}