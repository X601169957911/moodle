{"version":3,"sources":["../src/drawer.js"],"names":["backdropPromise","Sizes","medium","large","pageWrapper","document","getElementById","page","getBackdrop","Templates","render","then","html","ModalBackdrop","fail","Notification","exception","closeNav","navRegion","toggleButton","closeBackdrop","preference","getAttribute","state","isMedium","M","util","set_user_preference","backdrop","hide","style","overflow","showNav","setZIndex","show","getRoot","addEventListener","trigger","dispatchEvent","CustomEvent","bubbles","detail","body","clientWidth","isLarge","region","toggle","querySelector","closeButton","window","e"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Toggling the visibility of the secondary navigation on mobile.\n *\n * @package    theme_boost\n * @copyright  2021 Bas Brands\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport {classUtil} from 'core/utils';\nimport ModalBackdrop from 'core/modal_backdrop';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nlet backdropPromise = null;\n/**\n * Simple object of sizes to respond to so we can easily modify as required.\n */\nconst Sizes = {\n    medium: 991,\n    large: 1200\n};\n\nconst pageWrapper = document.getElementById('page-wrapper');\nconst page = document.getElementById('page');\n\nconst getBackdrop = () => {\n    if (!backdropPromise) {\n        // Would look to see if there is a way to migrate this to renderForPromise to remove the .then().\n        // Interesting idea to use some of the modal factory. Unsure if it is a good idea or\n        // if it should be more of a generic helper.\n        backdropPromise = Templates.render('core/modal_backdrop', {})\n            .then(html => {\n                return new ModalBackdrop(html);\n            })\n            .fail(Notification.exception);\n    }\n    return backdropPromise;\n};\n\nconst closeNav = (navRegion, toggleButton, closeBackdrop = true) => {\n    const preference = toggleButton.getAttribute('data-preference');\n    const state = toggleButton.getAttribute('data-state');\n    classUtil('remove', navRegion, 'show');\n\n    if (state) {\n        classUtil('remove', page, state);\n    }\n    if (!isMedium() && preference) {\n        M.util.set_user_preference(preference, 'false');\n    }\n\n    if (isMedium() && closeBackdrop) {\n        getBackdrop().then(backdrop => {\n            backdrop.hide();\n            pageWrapper.style.overflow = 'auto';\n        });\n    }\n};\n\nconst showNav = (navRegion, toggleButton) => {\n    const preference = toggleButton.getAttribute('data-preference');\n    const state = toggleButton.getAttribute('data-state');\n    classUtil('add', navRegion, 'show');\n\n    if (!isMedium() && preference) {\n        M.util.set_user_preference(preference, 'true');\n    }\n    if (state) {\n        classUtil('add', page, state);\n    }\n\n    if (isMedium()) {\n        getBackdrop().then(backdrop => {\n            backdrop.setZIndex(1020);\n            backdrop.show();\n            pageWrapper.style.overflow = 'hidden';\n            backdrop.getRoot()[0].addEventListener('click', () => {\n                closeNav(navRegion);\n            });\n        });\n    }\n\n    const trigger = navRegion.getAttribute('data-trigger');\n    if (trigger) {\n        navRegion.dispatchEvent(new CustomEvent('show-boost-drawer', { bubbles: true, detail: trigger }));\n    }\n};\n\nconst isMedium = () => {\n    return document.body.clientWidth <= Sizes.medium;\n};\n\nconst isLarge = () => {\n    return document.body.clientWidth <= Sizes.large;\n};\n\nexport const region = (region, toggle) => {\n    const navRegion = document.querySelector(region);\n    const toggleButton = document.querySelector(toggle);\n\n    if (!navRegion) {\n        return '';\n    }\n\n    const closeButton = navRegion.querySelector('[data-action=\"closedrawer\"]');\n\n    toggleButton.addEventListener('click', () => {\n        if (classUtil('has', navRegion, 'show')) {\n            closeNav(navRegion, toggleButton);\n        } else {\n            showNav(navRegion, toggleButton);\n        }\n    });\n\n    if (closeButton) {\n        closeButton.addEventListener('click', () => {\n            closeNav(navRegion, toggleButton);\n        });\n    }\n    if (toggleButton.getAttribute('data-closeonresize')) {\n        window.addEventListener('resize', () => {\n            closeNav(navRegion, toggleButton);\n        });\n    }\n\n    // Close drawer when another drawer opens.\n    document.addEventListener('show-boost-drawer', e => {\n        const trigger = navRegion.getAttribute('data-trigger');\n        if (trigger != e.detail && isLarge()) {\n            closeNav(navRegion, toggleButton, false);\n        }\n    });\n\n};\n"],"file":"drawer.min.js"}