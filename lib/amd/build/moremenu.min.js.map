{"version":3,"sources":["../src/moremenu.js"],"names":["sel","regions","moredropdown","classes","nav","navlink","dropdownitem","dropdownmoremenu","observed","hidden","autoCollapse","menu","navHeight","offsetHeight","maxHeight","parentNode","window","outerWidth","dropdownMenu","querySelector","dropdown","classList","remove","menuNodes","Array","from","children","reverse","forEach","item","contains","lastNode","removeChild","navLink","hasAttribute","setAttribute","prepend","add","currentAttribute","getAttribute","removeAttribute","insertBefore","addEventListener","e","target","stopPropagation","dropdowns","querySelectorAll","dd","innerDropdown","document","getElementById","init","PubSub","subscribe"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Moves wrapping navigation items into a more menu.\n *\n * @module     core/moremenu\n * @class      moremenu\n * @package    core\n * @copyright  2021 Moodle\n * @author     Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {classUtil} from 'core/utils';\nimport * as PubSub from 'core/pubsub';\n\n/**\n * Moremenu constants.\n */\nconst sel = {\n    regions: {\n        moredropdown: '[data-region=\"moredropdown\"]',\n    },\n    classes: {\n        nav: 'nav',\n        navlink: 'nav-link',\n        dropdownitem: 'dropdown-item',\n        dropdownmoremenu: 'dropdownmoremenu',\n        observed: 'observed',\n        hidden: 'd-none',\n    }\n};\n\n/**\n * Auto Collapse navigation items that wrap into a dropdown menu.\n *\n * @param {Object} container The navbar container.\n */\nconst autoCollapse = (menu) => {\n\n    let navHeight = menu.offsetHeight;\n    let maxHeight = menu.parentNode.offsetHeight;\n\n    if (window.outerWidth < 768) {\n        navHeight = maxHeight;\n    }\n\n    const dropdownMenu = menu.querySelector(sel.regions.moredropdown);\n    const dropdown = menu.querySelector('.' + sel.classes.dropdownmoremenu);\n\n    if (navHeight > maxHeight) {\n\n        dropdown.classList.remove(sel.classes.hidden);\n\n        if ('children' in menu) {\n            const menuNodes = Array.from(menu.children).reverse();\n            menuNodes.forEach( (item) => {\n                if (!item.classList.contains(sel.classes.dropdownmoremenu)) {\n                    if (menu.offsetHeight > maxHeight) {\n                        const lastNode = menu.removeChild(item);\n                        const navLink = lastNode.querySelector('.' + sel.classes.navlink);\n                        if (navLink && !navLink.hasAttribute('role')) {\n                            // Adding the menuitem role so the dropdown includes the\n                            // Accessibility improvements from theme/boost/amd/src/aria.js\n                            navLink.setAttribute('role', 'menuitem');\n                        }\n                        classUtil('replace', navLink, sel.classes.navlink, sel.classes.dropdownitem);\n                        dropdownMenu.prepend(lastNode);\n                    }\n                }\n            });\n        }\n    }\n    else {\n        dropdown.classList.add(sel.classes.hidden);\n\n        if ('children' in dropdownMenu) {\n            const menuNodes = Array.from(dropdownMenu.children);\n            menuNodes.forEach( (item) => {\n                if (window.outerWidth < 992 || menu.offsetHeight < maxHeight) {\n                    const lastNode = dropdownMenu.removeChild(item);\n                    const navLink = lastNode.querySelector('.' + sel.classes.dropdownitem);\n                    if (navLink) {\n                        const currentAttribute = navLink.getAttribute('role');\n                        if (currentAttribute == 'menuitem') {\n                            navLink.removeAttribute('role');\n                        }\n                    }\n                    classUtil('replace', navLink, sel.classes.dropdownitem, sel.classes.navlink);\n                    menu.insertBefore(lastNode, dropdown);\n                }\n            });\n        }\n        if (window.outerWidth > 768) {\n            navHeight = menu.offsetHeight;\n            if (navHeight > maxHeight) {\n                autoCollapse(menu);\n            }\n        }\n    }\n\n    // Create an accordion effect for all dropdownmenus\n    // pushed into the more menu\n    dropdownMenu.addEventListener('click', function(e) {\n        if (e.target.classList.contains('dropdown-toggle')) {\n            e.stopPropagation();\n            const dropdowns = dropdownMenu.querySelectorAll('.dropdown-menu .dropdown-menu');\n            dropdowns.forEach((dd) => {\n                classUtil('remove', dd, 'showinmoremenu');\n            });\n            const innerDropdown = document.getElementById(e.target.getAttribute('aria-controls'));\n            classUtil('toggle', innerDropdown, 'showinmoremenu');\n        }\n    });\n\n    classUtil('add', menu.parentNode, sel.classes.observed);\n};\n\n/**\n * Initialise the more menus.\n *\n * @param {Object} menu The navbar moremenu.\n */\nconst init = menu => {\n    autoCollapse(menu);\n    window.addEventListener('resize', () => {\n        autoCollapse(menu);\n    });\n    PubSub.subscribe('show-drawer', () => {\n        autoCollapse(menu);\n    });\n};\n\nexport default {\n    init: init,\n};\n"],"file":"moremenu.min.js"}