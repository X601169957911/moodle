{"version":3,"sources":["../src/moremenu.js"],"names":["Selectors","regions","moredropdown","classes","dropdownitem","dropdownmoremenu","dropdowntoggle","hidden","active","nav","navlink","observed","autoCollapse","menu","maxHeight","parentNode","offsetHeight","dropdownMenu","querySelector","dropdown","dropdownToggle","children","length","classList","remove","menuNodes","Array","from","reverse","forEach","item","contains","lastNode","removeChild","navLink","hasAttribute","setAttribute","add","prepend","currentAttribute","getAttribute","removeAttribute","insertBefore","window","addEventListener","document","setTimeout"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Moves wrapping navigation items into a more menu.\n *\n * @module     core/moremenu\n * @package    core\n * @copyright  2021 Moodle\n * @author     Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {classUtil} from 'core/utils';\n\n/**\n * Moremenu selectors.\n */\nconst Selectors = {\n    regions: {\n        moredropdown: '[data-region=\"moredropdown\"]',\n    },\n    classes: {\n        dropdownitem: 'dropdown-item',\n        dropdownmoremenu: 'dropdownmoremenu',\n        dropdowntoggle: 'dropdown-toggle',\n        hidden: 'd-none',\n        active: 'active',\n        nav: 'nav',\n        navlink: 'nav-link',\n        observed: 'observed',\n    }\n};\n\n/**\n * Auto Collapse navigation items that wrap into a dropdown menu.\n *\n * @param {HTMLElement} menu The navbar container.\n */\nconst autoCollapse = menu => {\n\n    const maxHeight = menu.parentNode.offsetHeight + 1;\n\n    const dropdownMenu = menu.querySelector(Selectors.regions.moredropdown);\n    const dropdown = menu.querySelector('.' + Selectors.classes.dropdownmoremenu);\n    const dropdownToggle = menu.querySelector('.' + Selectors.classes.dropdowntoggle);\n\n    if (menu.offsetHeight > maxHeight || menu.children.length > 6) {\n\n        // Show the dropdown more menu.\n        dropdown.classList.remove(Selectors.classes.hidden);\n\n        const menuNodes = Array.from(menu.children).reverse();\n        menuNodes.forEach(item => {\n            if (!item.classList.contains(Selectors.classes.dropdownmoremenu)) {\n                if (menu.offsetHeight > maxHeight || menu.children.length > 6) {\n                    const lastNode = menu.removeChild(item);\n                    const navLink = lastNode.querySelector('.' + Selectors.classes.navlink);\n                    if (navLink && !navLink.hasAttribute('role')) {\n                        // Adding the menuitem role so the dropdown includes the\n                        // Accessibility improvements from theme/boost/amd/src/aria.js\n                        navLink.setAttribute('role', 'menuitem');\n                    }\n                    if (navLink.classList.contains(Selectors.classes.active)) {\n                        dropdownToggle.classList.add(Selectors.classes.active);\n                    }\n                    classUtil('replace', navLink, Selectors.classes.navlink, Selectors.classes.dropdownitem);\n                    dropdownMenu.prepend(lastNode);\n                }\n            }\n        });\n    } else {\n\n        // Hide the dropdown more menu.\n        dropdown.classList.add(Selectors.classes.hidden);\n        dropdownToggle.classList.remove(Selectors.classes.active);\n\n        if ('children' in dropdownMenu) {\n            const menuNodes = Array.from(dropdownMenu.children);\n            menuNodes.forEach(item => {\n                if (menu.offsetHeight < maxHeight) {\n                    const lastNode = dropdownMenu.removeChild(item);\n                    const navLink = lastNode.querySelector('.' + Selectors.classes.dropdownitem);\n                    if (navLink) {\n                        const currentAttribute = navLink.getAttribute('role');\n                        if (currentAttribute === 'menuitem') {\n                            navLink.removeAttribute('role');\n                        }\n                    }\n                    classUtil('replace', navLink, Selectors.classes.dropdownitem, Selectors.classes.navlink);\n                    menu.insertBefore(lastNode, dropdown);\n                }\n            });\n        }\n\n        if (menu.offsetHeight > maxHeight) {\n            autoCollapse(menu);\n        }\n    }\n\n    // Unsure if the added abstraction here is really useful.\n    classUtil('add', menu.parentNode, Selectors.classes.observed);\n};\n\n/**\n * Initialise the more menus.\n *\n * @param {HTMLElement} menu The navbar moremenu.\n */\nexport default menu => {\n    autoCollapse(menu);\n    window.addEventListener('resize', () => {\n        autoCollapse(menu);\n    });\n    document.addEventListener('show-boost-drawer', () => {\n        setTimeout(() => {\n            autoCollapse(menu);\n        }, 200);\n    });\n};\n"],"file":"moremenu.min.js"}